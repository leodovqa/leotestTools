# Builder Stage: Install dependencies
FROM node:18 as builder

WORKDIR /app

# Copy package files to leverage Docker cache
COPY package*.json ./

# Install dependencies (might still take time, but should succeed)
# We remove cache clean and npm upgrade for now to simplify and see if multi-stage helps
RUN npm install

# Copy application source code for the build step (if needed)
COPY . .

# Runner Stage: Copy dependencies and run the app
FROM node:18

WORKDIR /app

# Copy installed node_modules from the builder stage
COPY --from=builder /app/node_modules .next/cache ./

# Copy the rest of the application source code for hot-reloading
# We exclude node_modules and .next/cache as they are copied from the builder
COPY . ./

# Expose the development port
EXPOSE 3000

# Start the development server with hot reloading
CMD ["npm", "run", "dev"] 